<?php

namespace EVPOS\affectationBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ServiceRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ServiceRepository extends EntityRepository
{
    /**
     * Retourne la liste de tous les services
     */
    public function getServices() {
        $query = $this->createQueryBuilder('s')
            ->orderBy('s.codeService')
            ->where('s.codeService is not null')
            ->getQuery()
        ;

        return $query->getResult();
    }

    /**
     * Récupération d'un service à partir de son code
     */
    public function getService($codeService) {
        $query = $this->createQueryBuilder('s')
            ->setParameter('code', $codeService)
            ->where('s.codeService = :code')
            ->getQuery()
        ;

        return $query->getSingleResult();
    }

    /**
     * Teste si le service dont le code est passé en parametre existe
     */
    public function isService($codeService) {
        $nbService = $this->createQueryBuilder('s')
            ->select('count(s.codeService)')
            ->setParameter('code', $codeService)
            ->where('s.codeService = :code')
            ->getQuery()
            ->getSingleScalarResult()
        ;
        
        if ($nbService >= 1)
            $retour = true;
        else 
            $retour = false;
            
        return $retour;
    }
}
