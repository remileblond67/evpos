{% extends "EVPOSaffectationBundle::layout.html.twig" %}
{% block title%}Service {{service.codeService}}{% endblock%}

{% block content %}

<div class="row">
    <div class="col-lg-6">
        <h2>Service {{service.codeService}}</h2>
    </div>
    <div class="col-lg-6">
		<a target="_blank" href="{{path('evpos_exportDirServUtilUoXml_service', {'codeService': service.codeService})}}" class="btn btn-default">
			<span class="glyphicon glyphicon-export"></span>
			{{'xml.export'|trans}}
		</a>
    <a target="_blank" href="{{path('evpos_exportCsvUtilImprimanteDegim', {'codeService': service.codeService})}}" class="btn btn-default">
			<span class="glyphicon glyphicon-export"></span>
			{{'imprimante.export'|trans}}
		</a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Informations annuaire</h3>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-lg-1"><h4>{{'service.code'|trans}}</h4>{{service.codeService}}</div>
            <div class="col-lg-1"><h4>{{'service.codeSirh'|trans}}</h4>{{service.codeSirh}}</div>
            <div class="col-lg-2"><h4>Nom service</h4>{{service.libService}}</div>
            <div class="col-lg-3">
                <h4>Direction</h4>
                <a href="{{path('evpos_ficheDirection', {'codeDirection': service.direction.codeDirection})}}">
        					{{service.direction.codeDirection}} : {{service.direction.libDirection}}
        				</a>
            </div>
            <div class="col-lg-2">
                <h4>{{'riu.nom'|trans}}</h4>
                <ul>
                {% for riu in service.listeRiu %}
                    <li>
          						{{ riu.nomUtil }}
                      {% if riu.serviceUtil %}
                      (<a href="{{ path('evpos_ficheService', { 'codeService' : riu.serviceUtil.codeService }) }}" title="{{riu.serviceUtil.libService}}">{{riu.serviceUtil.codeService}}</a>)
                      {% endif %}
                    </li>
                {% endfor %}
            </div>
            <div class="col-lg-2">
                <h4>{{'service.noteAvancement'|trans}}</h4>
                <progress value="{{ service.noteAvancementMoca }}" max="100" title="{{ service.noteAvancementMoca }}%"></progress>
                <br>
                {{ service.noteAvancementMoca }}%
            </div>
            <div class="col-lg-1">
              <h4>{{'service.numEnsemble'|trans}}</h4>
              {{service.numEnsemble}}
              <a href="{{ path('evpos_update_service', { 'codeService' : service.codeService})}}">
                <span class="glyphicon glyphicon-pencil"></span>
              </a>
            </div>
        </div>
    </div>
</div>


<div class="panel panel-default">
    <div class="panel-heading">
        <div class="row">
            <div class="col-lg-12">
                <a role="button" data-toggle="collapse" data-parent="#accordionAppliService" href="#collapseAppliService" aria-expanded="true" aria-controls="collapseOne">
                <h3 class="panel-title">Applications gérées <div class="badge">{{service.listeAppliService|length}}</div></h3>
                </a>
            </div>
        </div>
    </div>
    <div id="collapseAppliService" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
          <table class="table table-striped table-bordered table-hover dataTable no-footer sortable">
              <thead>
                  <tr>
                      <td class="row">{{'application.code'|trans}}</td>
                      <td class="row">{{'application.nom'|trans}}</td>
                      <td class="row">{{'application.nature'|trans}}</td>
                      <td class="row">{{'application.noteAvancement'|trans}}</td>
                  </tr>
              </thead>
              <tbody>
                  {% for appli in service.listeAppliService | sort %}
                  <tr>
                      <td class="gradeA odd">
                          <a href="{{ path('evpos_ficheAppli', { 'codeAppli': appli.codeAppli }) }}">
                          {{appli.codeAppli}}
                          </a>
                      </td>
                      <td class="gradeA odd">
                        <a href="{{ path('evpos_ficheAppli', { 'codeAppli': appli.codeAppli }) }}">
                          {{appli.nomAppli}}
                        </a>
                      </td>
                      <td class="gradeA odd">
                        {{appli.natAppli}}
                      </td>
                      <td class="gradeA odd">
                        <progress max="100" value="{{appli.noteAvancementMoca}}" title="{{appli.noteAvancementMoca}}%">
                          {{appli.noteAvancementMoca}}%
                        </progress>
                      </td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <div class="row">
            <div class="col-lg-6">
                <a role="button" data-toggle="collapse" data-parent="#accordionUtils" href="#collapseAppli" aria-expanded="true" aria-controls="collapseOne">
                <h3 class="panel-title">
                  {{'applications.listeUsage'|trans}}
                  <div class="badge">{{service.listeAcces|length}}</div>
                </h3>
                </a>
            </div>
        </div>
    </div>
    <script>
    function hideAppliUsageDone() {
      $('#tabAppliUsage').find('tr.done').hide();
    }
    function showAppliUsageDone() {
      $('#tabAppliUsage').find('tr.done').show();
    }
    </script>
    <div id="collapseAppli" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
            <table id="tabAppliUsage" class="table table-striped table-bordered table-hover dataTable no-footer sortable">
                <thead>
                    <tr>
                        <td class="row">{{'application.code'|trans}}</td>
                        <td class="row">{{'application.nom'|trans}}</td>
            						<td class="row">{{'application.nature'|trans}}</td>
                        <td class="row">
                          {{'application.noteAvancement'|trans}}
                          <br>
                          <button type="button" onclick="showAppliUsageDone()" title="">
                            {{'app.all'|trans}}
                          </button>
                          <button type="button" onclick="hideAppliUsageDone()" title="{{'app.todo'|trans}}">
                            <span class="glyphicon glyphicon-refresh"></span>
                          </button>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    {% for appli in service.listeAcces | sort %}
                    <tr class="{% if (appli.appliAcces.noteAvancementMoca == "100" or appli.appliAcces.noteAvancementMoca == null) %}
                              done
                              {% endif %}">
                        <td class="gradeA odd">
                            <a href="{{ path('evpos_ficheAppli', { 'codeAppli': appli.appliAcces.codeAppli }) }}">
                            {{appli.appliAcces.codeAppli}}
                            </a>
                        </td>
                        <td class="gradeA odd">
                          <a href="{{ path('evpos_ficheAppli', { 'codeAppli': appli.appliAcces.codeAppli }) }}">
                            {{appli.appliAcces.nomAppli}}
                          </a>
                        </td>
            						<td class="gradeA odd">
                          {{appli.appliAcces.natAppli}}
                        </td>
                        <td class="gradeA odd">
                          <progress max="100" value="{{appli.appliAcces.noteAvancementMoca}}" title="{{appli.appliAcces.noteAvancementMoca}}%">
                            {{appli.appliAcces.noteAvancementMoca}}%
                          </progress>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>



<div class="panel panel-group panel-default" id="accordionUo" role="tablist" aria-multiselectable="true">
    <div class="row">
      <div class="col-lg-6">
        <div class="panel-heading">
            <h3 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#accordionUo" href="#collapseUo" aria-expanded="true" aria-controls="collapseOne">
                {{ 'uo.listeUsage'|trans }}
                <div class="badge">{{service.listeAccesUo|length}}</div>
            </a>
            </h3>
        </div>
      </div>
    </div>
    <div id="collapseUo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
          <div>
            <script>
            function hideUoDone() {
              $('#tabUo').find('tr.done').hide();
            }
            function showUoDone() {
              $('#tabUo').find('tr.done').show();
            }
            </script>
          </div>
            <table id="tabUo" class="table table-striped table-bordered table-hover dataTable no-footer sortable">
                <thead>
                    <tr>
                        <td class="row">{{ 'application.code'|trans }}</td>
                        <td class="row">{{ 'application.nature'|trans}}</td>
                        <td class="row">{{ 'uo.code'|trans }}</td>
                        <td class="row">{{ 'uo.nom'|trans }}</td>
                        <td class="row">{{ 'uo.migMoca'|trans }}</td>
                        <td class="row" colspan="2">
                          {{ 'uo.avancementMigMoca'|trans }}
                          <br>
                          <button type="button" onclick="showUoDone()" title="">
                            {{'app.all'|trans}}
                          </button>
                          <button type="button" onclick="hideUoDone()" title="{{'app.todo'|trans}}">
                            <span class="glyphicon glyphicon-refresh"></span>
                          </button>
                        </td>
                        <td class="row">{{ 'uo.ancienCitrix'|trans}}</td>
                        <td class="row">{{ 'uo.nbUtilService'|trans }}</td>
                        <td class="row">{{ 'uo.nbUtil'|trans}}</td>
                    </tr>
                </thead>
                <tbody>
                    {% for acces in service.listeAccesUo | sort %}
                    <tr class="gradeA odd
                        {% if acces.uoAcces.migMoca != true %}
                        nonMoca
                        {% endif %}
                        {% if (acces.uoAcces.noteAvancementMoca == "100" or acces.uoAcces.migMoca == false) %}
                        done
                        {% endif %}
                        ">
                        <td class="gradeA odd">
                          <a href="{{ path('evpos_ficheAppli', { 'codeAppli': acces.uoAcces.appli.codeAppli }) }}">
                            {{ acces.uoAcces.appli.codeAppli }}
                          </a>
                        </td>
                        <td class="gradeA off">
                          {{ acces.uoAcces.appli.natAppli }}
                        </td>
                        <td class="gradeA odd">
                            <a href="{{ path('evpos_ficheUo', { 'codeUo': acces.uoAcces.codeUo }) }}">
                                {{ acces.uoAcces.codeUo }}
                            </a>
                        </td>
                        <td class="gradeA odd">{{ acces.uoAcces.nomUo }}</td>
                        <td class="gradeA odd">{{ acces.uoAcces.migMocaLong }}</td>
                        <td class="gradeA odd">
                            <span class="{{acces.uoAcces.avancementMocaIcon}}" title="{{acces.uoAcces.avancementMocaDetail}}"></span>
                            {{ acces.uoAcces.avancementMoca }}
                        </td>
                        <td class="gradeA odd">
                          {% if acces.uoAcces.migMoca == true %}
                          <progress value="{{acces.uoAcces.noteAvancementMoca}}" max="100" title="{{acces.uoAcces.noteAvancementMoca}}%"></progress>
                          {% endif %}
                        </td>
                        <td class="gradeA odd">
                          {% if acces.uoAcces.ancienCitrix %}
                          <span class="ok glyphicon glyphicon-ok"></span>
                          {% endif %}
                        </td>
                        <td class="gradeA odd">{{ acces.nbUtil }} </td>
                        <td class="gradeA odd">{{ acces.uoAcces.listeAcces|length}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


<div class="panel panel-group panel-default" id="accordionUtils" role="tablist" aria-multiselectable="true">
    <div class="panel-heading">
        <h3 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#accordionUtils"
               href="#collapseUtil" aria-expanded="true" aria-controls="collapseOne">
            {{'service.listeAgent'|trans}}
            <div class="badge">{{service.listeUtilisateurs|length}}</div>
            </a>
        </h3>
    </div>
    <div id="collapseUtil" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
            <table id="testId">

            </table>
            <table class="table table-striped table-bordered table-hover dataTable no-footer sortable" id="tab">
               <thead>
                   <tr>
                       <td class="row">{{'utilisateur.matricule'|trans}}</td>
                       <td class="row">{{'utilisateur.nom'|trans}}</td>
                       <td class="row">{{'utilisateur.poste'|trans}}</td>
                       <td class="row">{{'utilisateur.lastLogin'|trans}}</td>
                   </tr>
               </thead>
                <tbody>
                   {% for util in service.listeUtilisateurs | sort %}
                    <tr class="gradeA odd">
                        <td>
                          <a href="{{path('evpos_ficheUtil', {'matUtil': util.matUtil})}}">{{util.matUtil}}</a>
                          {% if util.niveauVIP %}
                          <span class="glyphicon glyphicon-certificate important">{{ util.niveauVIP }}</span>
                          {% endif %}
                        </td>
                        <td>{{util.nomUtil}}</td>
                        <td>
                        {% for poste in util.listePostes %}
                        <a href="{{path('evpos_fichePoste', {'hostname': poste.hostname})}}">{{poste.hostname}}</a>
                        {% endfor %}
                        </td>
                        <td>{{util.lastLogin|date("d/m/Y") }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="panel panel-group panel-default" id="accordionPoste" role="tablist" aria-multiselectable="true">
    <div class="panel-heading">
        <h3 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#accordionPoste" href="#collapsePoste" aria-expanded="true" aria-controls="collapseOne">
            {{'poste.listeUsage'|trans}}
            <div class="badge">{{service.listePostes|length}}</div>
            </a>
        </h3>
    </div>
    <div id="collapsePoste" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <div class="panel-body">
            <table class="table table-striped table-bordered table-hover dataTable no-footer sortable">
               <thead>
                   <tr>
                       <td class="row">{{'poste.hostname'|trans}}</td>
                       <td class="row">{{'poste.utilisateurs'|trans}}</td>
                       <td class="row">{{'poste.categorie'|trans}}</td>
          					   <td class="row">{{'poste.modele'|trans}}</td>
                       <td class="row">{{'poste.ecran'|trans}}</td>
          					   <td class="row">{{'poste.avancementMigMoca'|trans}}</td>
                       <td class="row">{{'poste.typeUsage'|trans}}</td>
                       <td class="row">{{'poste.uo'|trans }}</td>
          					   <td class="row">{{'poste.localisation'|trans}}</td>
                       <td class="row">{{'poste.commentaire'|trans}}</td>
                   </tr>
               </thead>
                <tbody>
                   {% for poste in service.listePostes | sort %}
                    <tr class="gradeA odd">
                        <td><a href="{{path('evpos_fichePoste', {'hostname': poste.hostname})}}">{{poste.hostname}}</a></td>
                        <td>
                            {% for util in poste.listeUtilisateurs %}
                            <a href="{{path('evpos_ficheUtil', {'matUtil': util.matUtil})}}">{{util.matUtil}}</a> : {{util.nomUtil}}
                            {% endfor %}
                        </td>
                        <td>{{poste.categorie}}</td>
            						<td>{{poste.modele}}</td>
                        <td>
                        {% for ecran in poste.listeEcran %}
                            {{ecran}}
                        {% endfor %}
                        </td>
            						<td>
            							{{ poste.avancementMigMoca }}
            						</td>
                        <td>{{poste.typeUsage}}</td>
            						<td>
            						{% for uo in poste.listeUo %}
            							<li class="{% if uo.migMoca != true %}nonMoca{% endif %}">
            								<span class="{{uo.avancementMocaIcon}}"></span>
            								<a href="{{ path('evpos_ficheAppli', { 'codeAppli': uo.appli.codeAppli }) }}">
            								{{ uo.appli.codeAppli }}
            								</a>
            								:
            								<a href="{{path('evpos_ficheUo', {'codeUo': uo.codeUo})}}">
            								{{ uo.codeUo }}
            								</a>- {{ uo.nomUo }}</li>
            						{% endfor %}
            						</td>
                        <td>{{poste.localisation}}</td>
                        <td>{{poste.commentaire|raw}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{%endblock%}

{% block javascripts %}
<script type="text/javascript">
$(document).ready(function() {
  $.ajax({
    type: 'POST',
    url: "{{ path('evpos_agentsService', {'codeService': service.codeService}) }}",
    dataType: 'json',
    success: function (data) {
      //Handle your JSON data to update the DOM
      $.each(data, function(index, element) {
        $('#testId').append($('<tr>', {
          html: '<td >'+element.matUtil+'</td><td>'+element.momUtil+'</td><td>'+element.lastLogin.date+'</td>'
        }));
      });
    }
  });
});
</script>
{% endblock %}
